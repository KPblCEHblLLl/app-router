// @license Copyright (C) 2015 Erik Ringsmuth - MIT license
!function(t,e){function r(t,r,a){var i=e.createEvent("CustomEvent");return i.initCustomEvent(t,!1,!0,r),a.dispatchEvent(i)}function a(t){var e=t.parseUrl();if(e.hash!==b.hash&&e.path===b.path&&e.search===b.search&&e.isHashPath===b.isHashPath)return void d(e.hash);b=e;var a={path:e.path};if(r("state-change",a,t)){for(var n=t.firstElementChild;n;){if("APP-ROUTE"===n.tagName&&n.isMatchUrl(e.path))return void i(t,n,e);n=n.nextSibling}r("not-found",a,t)}}function i(t,e,a){if(e.hasAttribute("redirect"))return void t.go(e.getRedirectUrl(a.path),{replace:!0});if(t.activeRoute==e){var i=e.currentUrl;if(e.getUrlFullMatch(i.path)==e.getUrlFullMatch(a.path))return}var s={path:a.path,route:e,oldRoute:t.activeRoute};if(r("activate-route-start",s,t)&&r("activate-route-start",s,e)){var l=h(t,e,a,s);if(e.model=l,t.activeRoute&&t.activeRoute===e&&e.firstElementChild&&e.hasAttribute("element"))for(var p in l)l.hasOwnProperty(p)&&(e.firstElementChild[p]=l[p]);else t.previousRoute&&t.previousRoute.transitionAnimationInProgress&&c(t.previousRoute),t.activeRoute&&t.activeRoute.removeAttribute("active"),t.previousRoute=t.activeRoute,t.activeRoute=e,t.activeRoute.setAttribute("active","active"),t.activeRoute.currentUrl=a,e.hasAttribute("import")?n(t,e.getAttribute("import"),e,a,s):e.hasAttribute("element")?o(t,e.getAttribute("element"),e,a,s):e.firstElementChild&&"TEMPLATE"===e.firstElementChild.tagName&&u(t,e.firstElementChild,e,a,s)}}function n(t,r,a,i,n){function o(){s(t,u,r,a,i,n)}var u;v.hasOwnProperty(r)?(u=e.querySelector('link[href="'+r+'"]'),u.import?o():u.addEventListener("load",o)):(v[r]=!0,u=e.createElement("link"),u.setAttribute("rel","import"),u.setAttribute("href",r),u.addEventListener("load",o),e.head.appendChild(u))}function s(t,e,r,a,i,n){a.hasAttribute("active")&&(a.hasAttribute("template")?u(t,e.import.querySelector("template"),a,i,n):o(t,a.getAttribute("element")||r.split("/").slice(-1)[0].replace(".html",""),a,i,n))}function o(t,r,a,i,n){var s=e.createElement(r),o=h(t,a,i,n);for(var u in o)o.hasOwnProperty(u)&&(s[u]=o[u]);l(t,s,i,n)}function u(t,r,a,i,n){var s;if("createInstance"in r){var o=h(t,a,i,n);s=r.createInstance(o)}else s=e.importNode(r.content,!0);l(t,s,i,n)}function h(t,e,a,i){var n=g.routeArguments(e.getAttribute("path"),a.path,a.search,e.hasAttribute("regex"),"auto"===t.getAttribute("typecast"));return(e.hasAttribute("bindRouter")||t.hasAttribute("bindRouter"))&&(n.router=t),i.model=n,r("before-data-binding",i,t),r("before-data-binding",i,i.route),i.model}function l(t,e,a,i){t.hasAttribute("core-animated-pages")&&i.route!==i.oldRoute||p(t.previousRoute),t.activeRoute.appendChild(e),t.hasAttribute("core-animated-pages")&&(t.coreAnimatedPages.selected=t.activeRoute.getAttribute("path"),t.previousRoute&&(t.previousRoute.transitionAnimationInProgress=!0)),a.hash&&!t.hasAttribute("core-animated-pages")&&d(a.hash),r("activate-route-end",i,t),r("activate-route-end",i,i.route)}function c(t){t&&(t.transitionAnimationInProgress=!1,p(t))}function p(t){if(t)for(var e=t.firstChild;e;){var r=e;e=e.nextSibling,"TEMPLATE"!==r.tagName&&t.removeChild(r)}}function d(t){t&&setTimeout(function(){var r=e.querySelector("html /deep/ "+t)||e.querySelector('html /deep/ [name="'+t.substring(1)+'"]');r&&r.scrollIntoView&&r.scrollIntoView(!0)},0)}function f(t,e,r,a,i){var n=t[e],s=r[a];if("**"===n&&e===t.length-1)return!0;if("undefined"==typeof n||"undefined"==typeof s)return n===s;if(n===s||"*"===n||":"===n.charAt(0))return":"===n.charAt(0)&&"undefined"!=typeof i&&(i[n.substring(1)]=r[a]),f(t,e+1,r,a+1,i);if("**"===n)for(var o=a;o<r.length;o++)if(f(t,e+1,r,o,i))return!0;return!1}var g={},v={},m="ActiveXObject"in t,b={},A=Object.create(HTMLElement.prototype);A.util=g;var R=Object.create(HTMLElement.prototype);R.util=g,R.attachedCallback=function(){this._defineHostRouter()},R._defineHostRouter=function(){for(var t,e=g.getParents(this),r=0;r<e.length;r++){var a=e[r];if("APP-ROUTER"==a.tagName){t=a;break}}this._hostRouter=t},R.isMatchUrl=function(t){return null!=this.getUrlFullMatch(t)},R._isFromRoot=function(t){return t=t||this.getAttribute("path"),"/"===t.substr(0,1)},R.getUrlFullMatch=function(t){t=g.normalizePath(t,!1);var e="";if(!this._isFromRoot()){if(this._hostRouter&&(e=this._hostRouter.getUrlFullMatch(t)),null==e)return null;e=g.normalizePath(e,!1)}t=t.substr(e.length);var r=this.getUrlMatch(t);return null==r?null:e+r},R.getUrlMatch=function(t){var e=this.getAttribute("path"),r=this._hostRouter.getAttribute("trailingSlash"),a=this._hostRouter.hasAttribute("regex");if(t=g.normalizePath(t,"ignore"===r),e=g.normalizePath(e,"ignore"===r&&!a),a)return g.testRegExString(e,t);if("*"===e)return t;for(var i=e.split("/"),n=t.split("/"),s=!0,o=[],u=0;u<i.length;u++){var h=i[u],l=n[u];if(h!=l)if(":"!==h.substr(0,1)){if("*"===h.substr(0,1))break;s=!1}else o.push(l);else o.push(l)}return s?o.join("/"):null},R.getRedirectUrl=function(t){var e=this.getAttribute("redirect"),r="";return this._isFromRoot(e)||(this._hostRouter&&(r=this._hostRouter.getUrlFullMatch(t)),r=g.normalizePath(r,!0)),r+e},A.attachedCallback=function(){this._defineParentRoute(),"manual"!==this.getAttribute("init")&&this.init()},A._defineParentRoute=function(){for(var t,e=g.getParents(this),r=0;r<e.length;r++){var a=e[r];if("APP-ROUTE"==a.tagName){t=a;break}}this._parentRoute=t},A.getUrlFullMatch=function(t){return t=null!=t?t:this.parseUrl().path,this._parentRoute?this._parentRoute.getUrlFullMatch(t):""},A.parseUrl=function(e){return e=null!=e?e:t.location.href,g.parseUrl(e,this.getAttribute("mode"))},A.init=function(){var r=this;r.isInitialized||(r.isInitialized=!0,r.hasAttribute("trailingSlash")||r.setAttribute("trailingSlash","strict"),r.hasAttribute("mode")||r.setAttribute("mode","auto"),r.hasAttribute("typecast")||r.setAttribute("typecast","auto"),r.hasAttribute("core-animated-pages")&&(r.createShadowRoot(),r.coreAnimatedPages=e.createElement("core-animated-pages"),r.coreAnimatedPages.appendChild(e.createElement("content")),r.coreAnimatedPages.style.position="static",r.coreAnimatedPages.setAttribute("valueattr","path"),r.coreAnimatedPages.setAttribute("transitions",r.getAttribute("transitions")),r.shadowRoot.appendChild(r.coreAnimatedPages),r.coreAnimatedPages.addEventListener("core-animated-pages-transition-end",function(){c(r.previousRoute)})),r.stateChangeHandler=a.bind(null,r),t.addEventListener("popstate",r.stateChangeHandler,!1),m&&t.addEventListener("hashchange",r.stateChangeHandler,!1),setTimeout(function(){a(r)},0))},A.detachedCallback=function(){t.removeEventListener("popstate",this.stateChangeHandler,!1),m&&t.removeEventListener("hashchange",this.stateChangeHandler,!1)},A.go=function(r,a){"pushstate"!==this.getAttribute("mode")&&(r="#"+r),a&&a.replace===!0?t.history.replaceState(null,null,r):t.history.pushState(null,null,r);try{var i=new PopStateEvent("popstate",{bubbles:!1,cancelable:!1,state:{}});"dispatchEvent_"in t?t.dispatchEvent_(i):t.dispatchEvent(i)}catch(n){var s=e.createEvent("CustomEvent");s.initCustomEvent("popstate",!1,!1,{state:{}}),t.dispatchEvent(s)}},g.parseUrl=function(t,r){var a={isHashPath:"hash"===r};if("function"==typeof URL){var i=new URL(t);a.path=i.pathname,a.hash=i.hash,a.search=i.search}else{var n=e.createElement("a");n.href=t,a.path=n.pathname,"/"!==a.path.charAt(0)&&(a.path="/"+a.path),a.hash=n.hash,a.search=n.search}if("pushstate"!==r&&("#/"===a.hash.substring(0,2)?(a.isHashPath=!0,a.path=a.hash.substring(1)):"#!/"===a.hash.substring(0,3)?(a.isHashPath=!0,a.path=a.hash.substring(2)):a.isHashPath&&(a.path=0===a.hash.length?"/":a.hash.substring(1)),a.isHashPath)){a.hash="";var s=a.path.indexOf("#");-1!==s&&(a.hash=a.path.substring(s),a.path=a.path.substring(0,s));var o=a.path.indexOf("?");-1!==o&&(a.search=a.path.substring(o),a.path=a.path.substring(0,o))}return a},g.testRoute=function(t,e,r,a){return"ignore"===r&&("/"===e.slice(-1)&&(e=e.slice(0,-1)),"/"!==t.slice(-1)||a||(t=t.slice(0,-1))),a?g.testRegExString(t,e):t===e||"*"===t?!0:("/"!==t.charAt(0)&&(t="/**/"+t),f(t.split("/"),1,e.split("/"),1))},g.routeArguments=function(t,e,r,a,i){var n={};a||("/"!==t.charAt(0)&&(t="/**/"+t),f(t.split("/"),1,e.split("/"),1,n));var s=r.substring(1).split("&");1===s.length&&""===s[0]&&(s=[]);for(var o=0;o<s.length;o++){var u=s[o],h=u.split("=");n[h[0]]=h.splice(1,h.length-1).join("=")}if(i)for(var l in n)n[l]=g.typecast(n[l]);return n},g.typecast=function(t){return"true"===t?!0:"false"===t?!1:isNaN(t)||""===t||"0"===t.charAt(0)?decodeURIComponent(t):+t},g.testRegExString=function(t,e){if("/"!==t.charAt(0))return!1;t=t.slice(1);var r="";if("/"===t.slice(-1))t=t.slice(0,-1);else{if("/i"!==t.slice(-2))return!1;t=t.slice(0,-2),r="i"}return new RegExp(t,r).test(e)},g.getParents=function(t,e){e=e||[];var r;return r=11==t.nodeType?t.host:t.parentNode,r?(e.push(r),g.getParents(r,e)):e},g.normalizePath=function(t,e){return"/"===t.substr(0,1)&&(t=t.substr(1)),e&&"/"!==t.slice(-1)&&(t+="/"),t},t.__AppRouterConstructors=[A,R]}(window,document);